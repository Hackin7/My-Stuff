<h1>node-temp</h1>
<p>Temporary files, directories, and streams for Node.js.</p>
<p>Handles generating a unique file/directory name under the appropriate
system temporary directory, changing the file to an appropriate mode,
and supports automatic removal (if asked)</p>
<p><code>temp</code> has a similar API to the <code>fs</code> module.</p>
<h2>Node.js Compatibility</h2>
<p>Supports v4.0.0+.</p>
<p><a href="https://travis-ci.org/bruce/node-temp"><img alt="Build Status" src="https://travis-ci.org/bruce/node-temp.png" /></a></p>
<p>Please let me know if you have problems running it on a later version of Node.js or
have platform-specific problems.</p>
<h2>Installation</h2>
<p>Install it using <a href="http://github.com/isaacs/npm">npm</a>:</p>
<pre><code>$ npm install temp
</code></pre>
<p>Or get it directly from:
http://github.com/bruce/node-temp</p>
<h2>Synopsis</h2>
<p>You can create temporary files with <code>open</code> and <code>openSync</code>, temporary
directories with <code>mkdir</code> and <code>mkdirSync</code>, or you can get a unique name
in the system temporary directory with <code>path</code>.</p>
<p>Working copies of the following examples can be found under the
<code>examples</code> directory.</p>
<h3>Temporary Files</h3>
<p>To create a temporary file use <code>open</code> or <code>openSync</code>, passing
them an optional prefix, suffix, or both (see below for details on
affixes). The object passed to the callback (or returned) has
<code>path</code> and <code>fd</code> keys:</p>
<p><code>javascript
{ path: "/path/to/file",
, fd: theFileDescriptor
}</code></p>
<p>In this example we write to a temporary file and call out to <code>grep</code> and
<code>wc -l</code> to determine the number of time <code>foo</code> occurs in the text.  The
temporary file is chmod'd <code>0600</code> and cleaned up automatically when the
process at exit (because <code>temp.track()</code> is called):</p>
<p>```javascript
var temp = require('temp'),
    fs   = require('fs'),
    util  = require('util'),
    exec = require('child_process').exec;</p>
<p>// Automatically track and cleanup files at exit
temp.track();</p>
<p>// Fake data
var myData = "foo\nbar\nfoo\nbaz";</p>
<p>// Process the data (note: error handling omitted)
temp.open('myprefix', function(err, info) {
  if (!err) {
    fs.write(info.fd, myData);
    fs.close(info.fd, function(err) {
      exec("grep foo '" + info.path + "' | wc -l", function(err, stdout) {
        util.puts(stdout.trim());
      });
    });
  }
});
```</p>
<h3>Want Cleanup? Make sure you ask for it.</h3>
<p>As noted in the example above, if you want temp to track the files and
directories it creates and handle removing those files and directories
on exit, you must call <code>track()</code>. The <code>track()</code> function is chainable,
and it's recommended that you call it when requiring the module.</p>
<p><code>javascript
var temp = require("temp").track();</code></p>
<p>Why is this necessary? In pre-0.6 versions of temp, tracking was
automatic. While this works great for scripts and
<a href="http://gruntjs.com/">Grunt tasks</a>, it's not so great for long-running
server processes. Since that's arguably what Node.js is <em>for</em>, you
have to opt-in to tracking.</p>
<p>But it's easy.</p>
<h4>Cleanup anytime</h4>
<p>When tracking, you can run <code>cleanup()</code> and <code>cleanupSync()</code> anytime
(<code>cleanupSync()</code> will be run for you on process exit). An object will
be returned (or passed to the callback) with cleanup counts and
the file/directory tracking lists will be reset.</p>
<p>```javascript</p>
<blockquote>
<p>temp.cleanupSync();
{ files: 1,
  dirs:  0 }
```</p>
</blockquote>
<p>```javascript</p>
<blockquote>
<p>temp.cleanup(function(err, stats) {
    console.log(stats);
  });
{ files: 1,
  dirs:  0 }
```</p>
</blockquote>
<p>Note: If you're not tracking, an error ("not tracking") will be passed
to the callback.</p>
<h3>Temporary Directories</h3>
<p>To create a temporary directory, use <code>mkdir</code> or <code>mkdirSync</code>, passing
it an optional prefix, suffix, or both (see below for details on affixes).</p>
<p>In this example we create a temporary directory, write to a file
within it, call out to an external program to create a PDF, and read
the result.  While the external process creates a lot of additional
files, the temporary directory is removed automatically at exit (because
<code>temp.track()</code> is called):</p>
<p>```javascript
var temp = require('temp'),
    fs   = require('fs'),
    util = require('util'),
    path = require('path'),
    exec = require('child_process').exec;</p>
<p>// Automatically track and cleanup files at exit
temp.track();</p>
<p>// For use with ConTeXt, http://wiki.contextgarden.net
var myData = "\starttext\nHello World\n\stoptext";</p>
<p>temp.mkdir('pdfcreator', function(err, dirPath) {
  var inputPath = path.join(dirPath, 'input.tex')
  fs.writeFile(inputPath, myData, function(err) {
    if (err) throw err;
    process.chdir(dirPath);
    exec("texexec '" + inputPath + "'", function(err) {
      if (err) throw err;
      fs.readFile(path.join(dirPath, 'input.pdf'), function(err, data) {
        if (err) throw err;
        sys.print(data);
      });
    });
  });
});
```</p>
<h3>Temporary Streams</h3>
<p>To create a temporary WriteStream, use 'createWriteStream', which sits
on top of <code>fs.createWriteStream</code>. The return value is a
<code>fs.WriteStream</code> with a <code>path</code> property containing the temporary file
path for the stream. The <code>path</code> is registered for removal when
<code>temp.cleanup</code> is called (because <code>temp.track()</code> is called).</p>
<p>```javascript
var temp = require('temp');</p>
<p>// Automatically track and cleanup files at exit
temp.track();</p>
<p>var stream = temp.createWriteStream();
// stream.path contains the temporary file path for the stream
stream.write("Some data");
// Maybe do some other things
stream.end();
```</p>
<h3>Affixes</h3>
<p>You can provide custom prefixes and suffixes when creating temporary
files and directories. If you provide a string, it is used as the prefix
for the temporary name. If you provide an object with <code>prefix</code>,
<code>suffix</code> and <code>dir</code> keys, they are used for the temporary name.</p>
<p>Here are some examples:</p>
<ul>
<li><code>"aprefix"</code>: A simple prefix, prepended to the filename; this is
  shorthand for:</li>
<li><code>{prefix: "aprefix"}</code>: A simple prefix, prepended to the filename</li>
<li><code>{suffix: ".asuffix"}</code>: A suffix, appended to the filename
  (especially useful when the file needs to be named with specific
  extension for use with an external program).</li>
<li><code>{prefix: "myprefix", suffix: "mysuffix"}</code>: Customize both affixes</li>
<li><code>{dir: path.join(os.tmpdir(), "myapp")}</code>: default prefix and suffix
  within a new temporary directory.</li>
<li><code>null</code>: Use the defaults for files and directories (prefixes <code>"f-"</code>
  and <code>"d-"</code>, respectively, no suffixes).</li>
</ul>
<p>In this simple example we read a <code>pdf</code>, write it to a temporary file with
a <code>.pdf</code> extension, and close it.</p>
<p>```javascript
var fs   = require('fs'),
    temp = require('temp');</p>
<p>fs.readFile('/path/to/source.pdf', function(err, data) {
  temp.open({suffix: '.pdf'}, function(err, info) {
    if (err) throw err;
    fs.write(info.fd, data);
    fs.close(info.fd, function(err) {
      if (err) throw err;
      // Do something with the file
    });
  });
});
```</p>
<h3>Just a path, please</h3>
<p>If you just want a unique name in your temporary directory, use
<code>path</code>:</p>
<p><code>javascript
var fs = require('fs');
var tempName = temp.path({suffix: '.pdf'});
// Do something with tempName</code></p>
<p>Note: The file isn't created for you, and the mode is not changed  -- and it
will not be removed automatically at exit.  If you use <code>path</code>, it's
all up to you.</p>
<h2>Using it with Grunt</h2>
<p>If you want to use the module with <a href="http://gruntjs.com/">Grunt</a>, make sure you
use <code>async()</code> in your Gruntfile:</p>
<p>```javascript
module.exports = function (grunt) {
  var temp = require("temp");
  temp.track(); // Cleanup files, please
  grunt.registerTask("temptest", "Testing temp", function() {</p>
<pre><code>var done = this.async(); // Don't forget this!

grunt.log.writeln("About to write a file...");
temp.open('tempfile', function(err, info) {
  // File writing shenanigans here
  grunt.log.writeln("Wrote a file!")

  done(); // REALLY don't forget this!

});
</code></pre>
<p>});
};
```</p>
<p>For more information, see the <a href="http://gruntjs.com/frequently-asked-questions#why-doesn-t-my-asynchronous-task-complete">Grunt FAQ</a>.</p>
<h2>Testing</h2>
<p><code>sh
$ npm test</code></p>
<h2>Contributing</h2>
<p>You can find the repository at:
http://github.com/bruce/node-temp</p>
<p>Issues/Feature Requests can be submitted at:
http://github.com/bruce/node-temp/issues</p>
<p>I'd really like to hear your feedback, and I'd love to receive your
pull-requests!</p>
<h2>Copyright</h2>
<p>Copyright (c) 2010-2014 Bruce Williams. This software is licensed
under the MIT License, see LICENSE for details.</p>