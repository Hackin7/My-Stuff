<h1>cookie</h1>
<p><a href="https://npmjs.org/package/cookie"><img alt="NPM Version" src="https://badgen.net/npm/v/cookie" /></a>
<a href="https://npmjs.org/package/cookie"><img alt="NPM Downloads" src="https://badgen.net/npm/dm/cookie" /></a>
<a href="https://nodejs.org/en/download"><img alt="Node.js Version" src="https://badgen.net/npm/node/cookie" /></a>
<a href="https://travis-ci.org/jshttp/cookie"><img alt="Build Status" src="https://badgen.net/travis/jshttp/cookie/master" /></a>
<a href="https://coveralls.io/r/jshttp/cookie?branch=master"><img alt="Test Coverage" src="https://badgen.net/coveralls/c/github/jshttp/cookie/master" /></a></p>
<p>Basic HTTP cookie parser and serializer for HTTP servers.</p>
<h2>Installation</h2>
<p><code>sh
$ npm install cookie</code></p>
<h2>API</h2>
<p><code>js
var cookie = require('cookie');</code></p>
<h3>cookie.parse(str, options)</h3>
<p>Parse an HTTP <code>Cookie</code> header string and returning an object of all cookie name-value pairs.
The <code>str</code> argument is the string representing a <code>Cookie</code> header value and <code>options</code> is an
optional object containing additional parsing options.</p>
<p><code>js
var cookies = cookie.parse('foo=bar; equation=E%3Dmc%5E2');
// { foo: 'bar', equation: 'E=mc^2' }</code></p>
<h4>Options</h4>
<p><code>cookie.parse</code> accepts these properties in the options object.</p>
<h5>decode</h5>
<p>Specifies a function that will be used to decode a cookie's value. Since the value of a cookie
has a limited character set (and must be a simple string), this function can be used to decode
a previously-encoded cookie value into a JavaScript string or other object.</p>
<p>The default function is the global <code>decodeURIComponent</code>, which will decode any URL-encoded
sequences into their byte representations.</p>
<p><strong>note</strong> if an error is thrown from this function, the original, non-decoded cookie value will
be returned as the cookie's value.</p>
<h3>cookie.serialize(name, value, options)</h3>
<p>Serialize a cookie name-value pair into a <code>Set-Cookie</code> header string. The <code>name</code> argument is the
name for the cookie, the <code>value</code> argument is the value to set the cookie to, and the <code>options</code>
argument is an optional object containing additional serialization options.</p>
<p><code>js
var setCookie = cookie.serialize('foo', 'bar');
// foo=bar</code></p>
<h4>Options</h4>
<p><code>cookie.serialize</code> accepts these properties in the options object.</p>
<h5>domain</h5>
<p>Specifies the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.3"><code>Domain</code> <code>Set-Cookie</code> attribute</a>. By default, no
domain is set, and most clients will consider the cookie to apply to only the current domain.</p>
<h5>encode</h5>
<p>Specifies a function that will be used to encode a cookie's value. Since value of a cookie
has a limited character set (and must be a simple string), this function can be used to encode
a value into a string suited for a cookie's value.</p>
<p>The default function is the global <code>encodeURIComponent</code>, which will encode a JavaScript string
into UTF-8 byte sequences and then URL-encode any that fall outside of the cookie range.</p>
<h5>expires</h5>
<p>Specifies the <code>Date</code> object to be the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.1"><code>Expires</code> <code>Set-Cookie</code> attribute</a>.
By default, no expiration is set, and most clients will consider this a "non-persistent cookie" and
will delete it on a condition like exiting a web browser application.</p>
<p><strong>note</strong> the <a href="https://tools.ietf.org/html/rfc6265#section-5.3">cookie storage model specification</a> states that if both <code>expires</code> and
<code>maxAge</code> are set, then <code>maxAge</code> takes precedence, but it is possible not all clients by obey this,
so if both are set, they should point to the same date and time.</p>
<h5>httpOnly</h5>
<p>Specifies the <code>boolean</code> value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.6"><code>HttpOnly</code> <code>Set-Cookie</code> attribute</a>. When truthy,
the <code>HttpOnly</code> attribute is set, otherwise it is not. By default, the <code>HttpOnly</code> attribute is not set.</p>
<p><strong>note</strong> be careful when setting this to <code>true</code>, as compliant clients will not allow client-side
JavaScript to see the cookie in <code>document.cookie</code>.</p>
<h5>maxAge</h5>
<p>Specifies the <code>number</code> (in seconds) to be the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.2"><code>Max-Age</code> <code>Set-Cookie</code> attribute</a>.
The given number will be converted to an integer by rounding down. By default, no maximum age is set.</p>
<p><strong>note</strong> the <a href="https://tools.ietf.org/html/rfc6265#section-5.3">cookie storage model specification</a> states that if both <code>expires</code> and
<code>maxAge</code> are set, then <code>maxAge</code> takes precedence, but it is possible not all clients by obey this,
so if both are set, they should point to the same date and time.</p>
<h5>path</h5>
<p>Specifies the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.4"><code>Path</code> <code>Set-Cookie</code> attribute</a>. By default, the path
is considered the <a href="https://tools.ietf.org/html/rfc6265#section-5.1.4">"default path"</a>.</p>
<h5>sameSite</h5>
<p>Specifies the <code>boolean</code> or <code>string</code> to be the value for the <a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-03#section-4.1.2.7"><code>SameSite</code> <code>Set-Cookie</code> attribute</a>.</p>
<ul>
<li><code>true</code> will set the <code>SameSite</code> attribute to <code>Strict</code> for strict same site enforcement.</li>
<li><code>false</code> will not set the <code>SameSite</code> attribute.</li>
<li><code>'lax'</code> will set the <code>SameSite</code> attribute to <code>Lax</code> for lax same site enforcement.</li>
<li><code>'none'</code> will set the <code>SameSite</code> attribute to <code>None</code> for an explicit cross-site cookie.</li>
<li><code>'strict'</code> will set the <code>SameSite</code> attribute to <code>Strict</code> for strict same site enforcement.</li>
</ul>
<p>More information about the different enforcement levels can be found in
<a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-03#section-4.1.2.7">the specification</a>.</p>
<p><strong>note</strong> This is an attribute that has not yet been fully standardized, and may change in the future.
This also means many clients may ignore this attribute until they understand it.</p>
<h5>secure</h5>
<p>Specifies the <code>boolean</code> value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.5"><code>Secure</code> <code>Set-Cookie</code> attribute</a>. When truthy,
the <code>Secure</code> attribute is set, otherwise it is not. By default, the <code>Secure</code> attribute is not set.</p>
<p><strong>note</strong> be careful when setting this to <code>true</code>, as compliant clients will not send the cookie back to
the server in the future if the browser does not have an HTTPS connection.</p>
<h2>Example</h2>
<p>The following example uses this module in conjunction with the Node.js core HTTP server
to prompt a user for their name and display it back on future visits.</p>
<p>```js
var cookie = require('cookie');
var escapeHtml = require('escape-html');
var http = require('http');
var url = require('url');</p>
<p>function onRequest(req, res) {
  // Parse the query string
  var query = url.parse(req.url, true, true).query;</p>
<p>if (query &amp;&amp; query.name) {
    // Set a new cookie with the name
    res.setHeader('Set-Cookie', cookie.serialize('name', String(query.name), {
      httpOnly: true,
      maxAge: 60 * 60 * 24 * 7 // 1 week
    }));</p>
<pre><code>// Redirect back after setting cookie
res.statusCode = 302;
res.setHeader('Location', req.headers.referer || '/');
res.end();
return;
</code></pre>
<p>}</p>
<p>// Parse the cookies on the request
  var cookies = cookie.parse(req.headers.cookie || '');</p>
<p>// Get the visitor name set in the cookie
  var name = cookies.name;</p>
<p>res.setHeader('Content-Type', 'text/html; charset=UTF-8');</p>
<p>if (name) {
    res.write('<p>Welcome back, <b>' + escapeHtml(name) + '</b>!</p>');
  } else {
    res.write('<p>Hello, new visitor!</p>');
  }</p>
<p>res.write('<form method="GET">');
  res.write('<input placeholder="enter your name" name="name"> <input type="submit" value="Set Name">');
  res.end('</form>');
}</p>
<p>http.createServer(onRequest).listen(3000);
```</p>
<h2>Testing</h2>
<p><code>sh
$ npm test</code></p>
<h2>Benchmark</h2>
<p>```
$ npm run bench</p>
<blockquote>
<p>cookie@0.3.1 bench cookie
node benchmark/index.js</p>
</blockquote>
<p>http_parser@2.8.0
  node@6.14.2
  v8@5.1.281.111
  uv@1.16.1
  zlib@1.2.11
  ares@1.10.1-DEV
  icu@58.2
  modules@48
  napi@3
  openssl@1.0.2o</p>
<blockquote>
<p>node benchmark/parse.js</p>
</blockquote>
<p>cookie.parse</p>
<p>6 tests completed.</p>
<p>simple      x 1,200,691 ops/sec ±1.12% (189 runs sampled)
  decode      x 1,012,994 ops/sec ±0.97% (186 runs sampled)
  unquote     x 1,074,174 ops/sec ±2.43% (186 runs sampled)
  duplicates  x   438,424 ops/sec ±2.17% (184 runs sampled)
  10 cookies  x   147,154 ops/sec ±1.01% (186 runs sampled)
  100 cookies x    14,274 ops/sec ±1.07% (187 runs sampled)
```</p>
<h2>References</h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc6265">RFC 6265: HTTP State Management Mechanism</a></li>
<li><a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-03#section-4.1.2.7">Same-site Cookies</a></li>
</ul>
<h2>License</h2>
<p><a href="LICENSE">MIT</a></p>